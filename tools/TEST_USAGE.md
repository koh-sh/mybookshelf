# Bookshelf CLI テスト実行ガイド

## 概要

このディレクトリには、Bookshelf CLIツールの自動テストスイートが含まれています。

## ファイル構成

- `test_bookshelf.py` - 自動テスト実行スクリプト
- `TEST_SPECIFICATION.md` - テスト仕様書
- `TEST_USAGE.md` - このファイル（使用方法ガイド）

## テスト実行方法

### 基本実行

```bash
cd tools/
python test_bookshelf.py
```

### 実行可能スクリプトとして実行

```bash
cd tools/
./test_bookshelf.py
```

## テスト内容

### 実行されるテスト項目（10項目）

1. **CLIヘルプ表示** - `--help` コマンドの動作確認
2. **本の追加** - 新しい本の追加機能
3. **重複追加エラー検出** - 同じ本を2回追加した際のエラーハンドリング
4. **読書開始** - ステータス更新（UNREAD → READING）
5. **読書完了** - ステータス更新（READING → READ）
6. **README生成** - README.mdの自動生成
7. **本の削除** - 本の削除機能
8. **存在しない本エラー検出** - 存在しない本への操作時のエラーハンドリング
9. **テストデータクリーンアップ** - テスト完了後のデータ削除確認
10. **extract_books.py実行** - ユーティリティスクリプトの動作確認

### 出力例

```text
🚀 Bookshelf CLI 自動テスト開始

📊 テスト開始時の書籍数: 87
🧹 テストデータをクリーンアップ中...

🔧 基本機能テスト
✅ PASS: CLIヘルプ表示
✅ PASS: 本の追加
✅ PASS: 重複追加エラー検出
✅ PASS: 読書開始(UNREAD→READING)
✅ PASS: 読書完了(READING→READ)
✅ PASS: README生成
✅ PASS: 本の削除

🚨 エラーハンドリングテスト
✅ PASS: 存在しない本エラー検出

🔍 データ整合性テスト
✅ PASS: テストデータクリーンアップ

🛠️ ユーティリティテスト
✅ PASS: extract_books.py実行

📊 テスト結果サマリー
   合計: 10 テスト
   成功: 10
   失敗: 0

🎉 全てのテストが成功しました！
```

## テストデータについて

### 使用するテストデータ

- **テスト用書籍名**: `テスト用書籍_自動テスト`
- **カテゴリ**: `AI`
- **言語**: `JPN`
- **タイプ**: `Kindle`

### データ安全性

- テストは本番データに影響を与えません
- 一意のテスト用データを使用します
- テスト完了後、全てのテストデータが自動削除されます
- テスト前後でデータ整合性をチェックします

## エラー時の対応

### テスト失敗時

テストが失敗した場合、以下の情報が表示されます：

```text
❌ FAIL: テスト名 - エラー詳細

📊 テスト結果サマリー
   合計: 10 テスト
   成功: 8
   失敗: 2

❌ 失敗したテスト:
   - テスト名: エラー詳細
```

### 手動クリーンアップ

万が一テストデータが残存した場合：

```bash
# テスト用データを手動削除
./bookshelf remove "テスト用書籍_自動テスト"

# README再生成
python generate_readme.py
```

## 前提条件

### 必要な環境

- Python 3.8以上
- 実行可能な `./bookshelf` スクリプト
- `tools/` ディレクトリ内での実行

### 依存ファイル

- `bookshelf_core.py` - コア機能モジュール
- `generate_readme.py` - README生成スクリプト
- `extract_books.py` - データ抽出スクリプト
- `../data/books.csv` - データファイル
- `../README.md` - 表示用ファイル

## 開発者向け情報

### テストの追加

新しいテストを追加する場合：

1. `test_bookshelf.py` に新しいテスト関数を追加
2. `main()` 関数でテストを呼び出し
3. `TEST_SPECIFICATION.md` に仕様を追加

### テスト関数の命名規則

```python
def test_機能名(result: TestResult) -> None:
    """テスト内容の説明"""
    # テスト実装
    if 成功条件:
        result.add_pass("テスト名")
    else:
        result.add_fail("テスト名", "エラー詳細")
```

## トラブルシューティング

### よくある問題

1. **PermissionError**: `bookshelf` スクリプトに実行権限がない

   ```bash
   chmod +x bookshelf
   ```

2. **FileNotFoundError**: 必要なファイルが見つからない
   - `tools/` ディレクトリで実行しているか確認
   - 必要なファイルが全て存在するか確認

3. **テストデータ競合**: 既存データとの競合
   - 手動でテストデータをクリーンアップ
   - CSVファイルの内容を確認

### ログ出力

詳細なデバッグが必要な場合、テストスクリプト内の出力を確認してください。各テストで実際のコマンド出力とエラーメッセージが含まれています。

## 継続的インテグレーション

このテストスイートは以下の用途で使用できます：

- **開発時の動作確認**
- **リリース前の品質保証**
- **機能追加後の回帰テスト**
- **CI/CDパイプラインでの自動テスト**

テストは約10-15秒で完了し、全機能の包括的な検証を行います。
