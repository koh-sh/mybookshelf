# Bookshelf CLI テスト仕様書

## テスト概要

bookshelf CLIツールの全機能について動作確認を行う包括的なテストスイートです。

## テスト項目

### 1. 基本機能テスト

#### 1.1 CLIヘルプ表示

- **テスト内容**: `./bookshelf --help` コマンドの実行
- **期待結果**: ヘルプメッセージが正常に表示される
- **検証方法**: 出力に "Bookshelf CLI Tool" が含まれることを確認

#### 1.2 本の追加機能

- **テスト内容**: `./bookshelf add` コマンドによる本の追加
- **テストデータ**: "テスト用書籍" (カテゴリ: AI, 言語: JPN, タイプ: Kindle)
- **期待結果**: "追加しました: テスト用書籍" のメッセージが表示される
- **検証方法**: CSVファイルに該当レコードが追加されることを確認

#### 1.3 ステータス更新機能

##### 1.3.1 読書開始 (UNREAD → READING)

- **テスト内容**: `./bookshelf start` コマンドによるステータス更新
- **期待結果**: "更新しました: テスト用書籍 → READING" のメッセージが表示される
- **検証方法**: CSVファイルでステータスが "READING" に更新されることを確認

##### 1.3.2 読書完了 (READING → READ)

- **テスト内容**: `./bookshelf finish` コマンドによるステータス更新
- **期待結果**: "更新しました: テスト用書籍 → READ" のメッセージが表示される
- **検証方法**: CSVファイルでステータスが "READ" に更新されることを確認

#### 1.4 README生成機能

- **テスト内容**: `python generate_readme.py` による README.md の生成
- **期待結果**: "README.md生成完了" のメッセージが表示される
- **検証方法**: README.md にテスト用書籍が正しいフォーマットで含まれることを確認

#### 1.5 本の削除機能

- **テスト内容**: `./bookshelf remove` コマンドによる本の削除
- **期待結果**: "削除しました: テスト用書籍" のメッセージが表示される
- **検証方法**: CSVファイルから該当レコードが削除されることを確認

### 2. エラーハンドリングテスト

#### 2.1 重複本追加の検出

- **テスト内容**: 同じ本を2回追加
- **期待結果**: 2回目の追加で "エラー: 'XXX' は既に登録されています" が表示される
- **検証方法**: エラーメッセージの確認とCSVに重複レコードが作成されないことを確認

#### 2.2 存在しない本の操作

- **テスト内容**: 存在しない本のステータス更新を試行
- **期待結果**: "エラー: 'XXX' を含む本が見つかりません" が表示される
- **検証方法**: エラーメッセージの確認

### 3. データ整合性テスト

#### 3.1 CSVとREADMEの同期

- **テスト内容**: README生成後のデータ一致確認
- **期待結果**: CSVの内容とREADMEの内容が一致する
- **検証方法**: CSVの行数とREADMEのテーブル行数の比較

#### 3.2 テストデータのクリーンアップ

- **テスト内容**: テスト完了後のデータ残存確認
- **期待結果**: テスト用データがCSVとREADMEの両方から完全に削除される
- **検証方法**: テスト用文字列の検索で0件であることを確認

### 4. ユーティリティ機能テスト

#### 4.1 extract_books.py実行テスト

- **テスト内容**: README.mdからCSVへの変換機能
- **期待結果**: "抽出完了: XX冊の本をdata/books.csvに保存しました" が表示される
- **検証方法**: 処理前後でCSVファイルの内容が適切に更新されることを確認

## テスト実行環境要件

- Python 3.8以上
- 実行可能な `./bookshelf` スクリプト
- `tools/` ディレクトリ内での実行

## テスト実行順序

1. 事前状態の記録（元のデータ行数など）
2. 基本機能テスト（追加→更新→生成→削除）
3. エラーハンドリングテスト
4. データ整合性の確認
5. クリーンアップ検証
6. 事後状態の確認（元の状態に戻っているか）

## 注意事項

- テストは本番データに影響を与えないよう、一意のテスト用データを使用
- 各テスト完了後は必ずクリーンアップを実行
- テスト失敗時は中断し、手動でのクリーンアップを実施
